function littleLOOKahead(n){return{items:[],itemsIndex:0,settings:{debounce_timeout:300,headers:{"Content-Type":"application/json","X-Requested-With":"littleLOOKahead"},items_limit:10,messages:{empty:"No matches",failed:"Failed to fetch anything",loading:"Looking..."},min_chars:2,search_on_delete:!0,throttle_timeout:150,url:null},state:{aria:{expanded:!1},display:!1,error:!1,loading:!1,throttle:!1},value:"",init(){this.value=this.$refs.input.getAttribute("value"),this.$refs.input.setAttribute("x-model","value"),this.$refs.input.setAttribute("x-on:keyup","inputKeyPressed()"),this.$refs.input.setAttribute("x-on:click","show()"),this.$refs.input.setAttribute("role","combobox"),this.$refs.input.setAttribute("aria-autocomplete","false"),this.$refs.input.setAttribute(":aria-expanded","state.aria.expanded"),this.$refs.input.setAttribute("aria-owns",`${this.$refs.input.id}-input-list`),this.$refs.items.setAttribute("role","listbox");for(i in n)this.settings.hasOwnProperty(i)&&(this.settings[i]=n[i]);this.settings.min_chars<1&&(this.settings.min_chars=1)},inputKeyPressed(){switch(this.value.length<this.settings.min_chars&&this.hide(),this.$event.key){case"Tab":case"Enter":break;case"ArrowDown":this.enter();break;case"ArrowUp":case"Escape":this.hide();break;case"Backspace":this.settings.search_on_delete&&this.debounce(this.fetch(),this.settings.debounce_timeout);break;default:this.debounce(this.fetch(),this.settings.debounce_timeout)}},itemKeyPressed(t,e){switch(this.$event.key){case"ArrowUp":this.prev(t);break;case"ArrowDown":this.next(t);break;case"ArrowRight":this.$refs.input.focus(),this.$refs.input.setSelectionRange(999,999);break;case"ArrowLeft":this.$refs.input.focus(),this.$refs.input.setSelectionRange(0,0);break;case"Enter":this.set(t,e);break;case"Escape":this.hide()}},fetch:function(){if(!(this.value.length<=this.settings.min_chars)){if(this.state.loading){console.log("STILL LOADING");return}console.log("FETCHING"),this.state.loading=!0,this.state.error=!1,fetch(`${this.settings.url}?limit=${this.settings.items_limit}&search=${this.value}`,{headers:this.settings.headers}).then(t=>t.json()).then(t=>{this.items=[];for(i in t)this.addRow(t[i]);this.show()}).then(()=>{this.state.loading=!1,this.state.error=!1}).catch(t=>{this.state.loading=!1,this.state.error=!0})}},addRow(t){(typeof t.id=="undefined"||typeof t.value=="undefined")&&console.log("Cannot add an option without id or value properties"),typeof t.content=="undefined"&&(t.content=t.value),this.items.push(t)},show(){this.items.length&&this.state.display==!1&&(this.state.display=!0,this.$refs.input.classList.add("has-focus"),this.state.aria.expanded=!0)},hide(){this.state.display=!1,this.state.aria.expanded=!1,this.$refs.input.classList.remove("has-focus"),this.$refs.input.focus()},enter(){this.show();let t=this.getItemsIndex(this.value);this.$refs.items.children[t].focus(),this.itemsIndex=t},prev(){this.itemsIndex>1?(this.itemsIndex=this.itemsIndex-1,this.$refs.items.children[this.itemsIndex].focus()):this.hide()},next(){this.itemsIndex<this.$refs.items.children.length-1&&(this.itemsIndex=this.itemsIndex+1,this.$refs.items.children[this.itemsIndex].focus())},set(t){this.value=t,this.hide()},getItemsIndex(t){for(let e=0;e<this.items.length;e++)if(this.items[e].value==t)return++e;return 1},debounce(t,e,h){var s;return console.log("debouncing search input"),function(){var r=this,a=arguments,o=function(){s=null,h||t.apply(r,a)},l=h&&!s;clearTimeout(s),s=setTimeout(o,e||200),l&&t.apply(r,a)}},throttle(){if(this.state.throttle){console.log("already throttling");return}this.state.throttle=setTimeout(()=>{console.log("throttle timeout set"),this.fetch(),this.state.throttle=!1},this.settings.throttle_timeout)},debug(){return`Value: ${this.value}
State: ${JSON.stringify(this.state)}
Settings: ${JSON.stringify(this.settings)}
Options: ${JSON.stringify(this.items)}
`}}}
