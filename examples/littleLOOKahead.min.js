function littleLOOKahead(s){return{items:[],itemsIndex:0,settings:{url:null,min:2,limit:10,headers:{"Content-Type":"application/json","X-Requested-With":"littleLOOKahead"},messages:{loading:"Looking...",failed:"Failed to fetch anything",empty:"No matches"}},state:{display:!1,error:!1,loading:!1,aria:{expanded:!1}},value:"",init(){this.value=this.$refs.input.getAttribute("value"),this.$refs.input.setAttribute("x-model","value"),this.$refs.input.setAttribute("x-on:keyup","inputKeyPressed()"),this.$refs.input.setAttribute("x-on:click","show()"),this.$refs.input.setAttribute("role","combobox"),this.$refs.input.setAttribute("aria-autocomplete","false"),this.$refs.input.setAttribute(":aria-expanded","state.aria.expanded"),this.$refs.input.setAttribute("aria-owns",`${this.$refs.input.id}-input-list`),this.$refs.items.setAttribute("role","listbox");for(i in s)this.settings.hasOwnProperty(i)&&(this.settings[i]=s[i])},inputKeyPressed(){switch(this.$event.key){case"Tab":case"Enter":break;case"ArrowDown":this.enter();break;case"Escape":this.hide();break;default:this.fetch()}},itemKeyPressed(t,e){switch(this.$event.key){case"ArrowUp":this.prev(t);break;case"ArrowDown":this.next(t);break;case"ArrowRight":this.$refs.input.focus(),this.$refs.input.setSelectionRange(999,999);break;case"ArrowLeft":this.$refs.input.focus(),this.$refs.input.setSelectionRange(0,0);break;case"Enter":this.set(t,e);break;case"Escape":this.hide()}},fetch:function(){!this.settings.url||this.state.loading||(this.state.loading=!0,this.state.error=!1,fetch(`${this.settings.url}?limit=${this.settings.limit}&search=${this.value}`,{headers:this.settings.headers}).then(t=>t.json()).then(t=>{this.items=[];for(i in t)this.addRow(t[i]);this.show()}).then(()=>{this.state.loading=!1,this.state.error=!1}).catch(t=>{this.state.loading=!1,this.state.error=!0}))},addRow(t){(typeof t.id=="undefined"||typeof t.value=="undefined")&&console.log("Cannot add an option without id or value properties"),typeof t.content=="undefined"&&(t.content=t.value),this.items.push(t)},show(){this.items.length&&this.state.display==!1&&(this.state.display=!0,this.$refs.input.classList.add("has-focus"),this.state.aria.expanded=!0)},hide(){this.state.display=!1,this.state.aria.expanded=!1,this.$refs.input.classList.remove("has-focus"),this.$refs.input.focus()},enter(){this.show();let t=this.getItemsIndex(this.value);this.$refs.items.children[t].focus(),this.itemsIndex=t},prev(){this.itemsIndex>1?(this.itemsIndex=this.itemsIndex-1,this.$refs.items.children[this.itemsIndex].focus()):this.hide()},next(){this.itemsIndex<this.$refs.items.children.length-1&&(this.itemsIndex=this.itemsIndex+1,this.$refs.items.children[this.itemsIndex].focus())},set(t){this.value=t,this.hide()},getItemsIndex(t){for(let e=0;e<this.items.length;e++)if(this.items[e].value==t)return++e;return 1},debug(){return`Value: ${this.value}
State: ${JSON.stringify(this.state)}
Settings: ${JSON.stringify(this.settings)}
Options: ${JSON.stringify(this.items)}
`}}}
